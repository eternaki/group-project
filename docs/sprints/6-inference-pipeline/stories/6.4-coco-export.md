# Story 6.4: COCO Export

**Status:** To Do
**Assignee:** U3 (Danylo Zherzdiev)
**Priority:** High
**Sprint:** 6 - Inference Pipeline

---

## Description

As a developer, I want to export annotations to COCO format.

---

## Acceptance Criteria

- [ ] COCODataset class implemented
- [ ] All required COCO fields populated
- [ ] Custom fields added (breed_id, emotion_id)
- [ ] JSON export validated with pycocotools

---

## Tasks

- [ ] Create COCODataset class
- [ ] Implement add_image() method
- [ ] Implement add_annotation() method
- [ ] Implement save() to JSON
- [ ] Validate with pycocotools
- [ ] Write tests

---

## COCO Format

```json
{
  "info": {
    "description": "Dog FACS Dataset",
    "version": "1.0",
    "year": 2025
  },
  "licenses": [],
  "images": [
    {
      "id": 1,
      "file_name": "video1_frame_000001.jpg",
      "width": 1920,
      "height": 1080,
      "source_video": "video1.mp4",
      "frame_number": 0
    }
  ],
  "annotations": [
    {
      "id": 1,
      "image_id": 1,
      "category_id": 1,
      "bbox": [100, 150, 200, 250],
      "area": 50000,
      "keypoints": [x1, y1, v1, ...],
      "num_keypoints": 20,
      "breed_id": 15,
      "emotion_id": 0,
      "confidence": {
        "bbox": 0.95,
        "breed": 0.87,
        "emotion": 0.72
      },
      "iscrowd": 0
    }
  ],
  "categories": [
    {
      "id": 1,
      "name": "dog",
      "supercategory": "animal",
      "keypoints": ["left_eye", "right_eye", ...],
      "skeleton": [[0,1], [0,2], ...]
    }
  ]
}
```

---

## Validation

```python
from pycocotools.coco import COCO

# Validate exported file
coco = COCO("annotations.json")
print(f"Images: {len(coco.imgs)}")
print(f"Annotations: {len(coco.anns)}")
```

---

## Output

- `packages/data/coco.py`
- `tests/test_data/test_coco.py`
