# Story 6.1: Pipeline Architecture

**Status:** To Do
**Assignee:** U3 (Danylo Zherzdiev)
**Priority:** High
**Sprint:** 6 - Inference Pipeline

---

## Description

As a developer, I want to design the inference pipeline architecture.

---

## Acceptance Criteria

- [ ] Pipeline class designed with clear interfaces
- [ ] Model loading strategy defined
- [ ] Data flow documented
- [ ] Error handling planned

---

## Tasks

- [ ] Design InferencePipeline class
- [ ] Define configuration dataclass
- [ ] Plan model lifecycle (load once, reuse)
- [ ] Design error handling for partial failures
- [ ] Document architecture

---

## Pipeline Design

```python
# packages/pipeline/inference.py

from dataclasses import dataclass
from pathlib import Path
from typing import Optional
import numpy as np

from packages.models import BBoxModel, BreedModel, KeypointsModel, EmotionModel
from packages.data.schemas import Annotation

@dataclass
class PipelineConfig:
    bbox_weights: Path
    breed_weights: Path
    keypoints_weights: Path
    emotion_weights: Path
    device: str = "cuda"
    confidence_threshold: float = 0.5

class InferencePipeline:
    """Unified inference pipeline for dog annotation."""

    def __init__(self, config: PipelineConfig):
        self.config = config
        self._models_loaded = False

    def load(self) -> None:
        """Load all models into memory."""
        pass

    def process_frame(self, image: np.ndarray) -> list[Annotation]:
        """Process single frame through all models."""
        pass

    def process_video(self, video_path: Path, fps: float = 1.0):
        """Process video and yield frame annotations."""
        pass
```

---

## Output

- `packages/pipeline/__init__.py`
- `packages/pipeline/inference.py`
- `docs/plans/pipeline-architecture.md`
