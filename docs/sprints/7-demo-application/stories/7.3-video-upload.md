# Story 7.3: Video Upload

**Status:** Done
**Assignee:** U1 (Danylo Lohachov)
**Priority:** Medium
**Sprint:** 7 - Demo Application
**Data ukoÅ„czenia:** 2025-01-23

---

## Description

As a user, I want to upload short videos for analysis with real-time visualization and export options.

---

## Acceptance Criteria

- [x] Video upload supported (MP4, MOV, AVI, WebM)
- [x] Frame extraction preview with configurable FPS
- [x] Support for MP4 format
- [x] Duration limit (max 30 sec)
- [x] YouTube URL support
- [x] Side-by-side visualization (original vs annotated)
- [x] Export to COCO JSON
- [x] Export annotated video with audio

---

## Tasks

- [x] Add video uploader (file upload)
- [x] Add YouTube URL downloader
- [x] Save to temp file for processing
- [x] Show video info (duration, resolution, estimated frames)
- [x] Implement real-time frame processing
- [x] Add side-by-side visualization
- [x] Add FPS slider in sidebar
- [x] Export COCO JSON for all frames
- [x] Export annotated video with FFmpeg

---

## Implementation

### Nowe pliki

- `packages/pipeline/downloader.py` - YouTubeDownloader class
- `packages/pipeline/video.py` - rozszerzony o `create_annotated_video()`

### Zmiany w istniejÄ…cych plikach

- `packages/pipeline/__init__.py` - dodano eksporty
- `apps/demo/app.py` - dodano zakÅ‚adkÄ™ Video z peÅ‚nÄ… funkcjonalnoÅ›ciÄ…

### Kluczowe komponenty

```python
# VideoProcessor - ekstrakcja klatek i tworzenie wideo
processor = VideoProcessor(fps_sample=2.0)
for frame_idx, frame in processor.extract_frames(video_path):
    result = pipeline.process_frame(frame)
    annotated = visualize_results(frame, result)

processor.create_annotated_video(original_path, annotated_frames, output_path)

# YouTubeDownloader - pobieranie z YouTube
downloader = YouTubeDownloader(max_duration=30)
info = downloader.get_video_info(url)
result = downloader.download(url)
```

### UI Features

- Tabs: "ðŸ“¸ Obraz" / "ðŸŽ¬ Wideo"
- FPS slider (0.5 - 5.0, default 2.0)
- Source selector: Upload / URL
- Real-time progress bar
- Side-by-side visualization
- Video statistics (frames with dogs, total detections, dominant emotion)
- Export: COCO JSON + annotated MP4

---

## Dependencies

- FFmpeg (system package) - dla eksportu wideo z dÅºwiÄ™kiem
- yt-dlp (Python package) - dla pobierania z YouTube

---

## Output

- `packages/pipeline/video.py` (updated)
- `packages/pipeline/downloader.py` (new)
- `packages/pipeline/__init__.py` (updated)
- `apps/demo/app.py` (updated)
- `docs/plans/2025-01-23-video-support-design.md` (design document)

---

## Notes

- Maksymalny czas wideo: 30 sekund
- Maksymalny rozmiar pliku: 100MB
- ObsÅ‚ugiwane formaty: MP4, MOV, AVI, WebM
- FFmpeg wymagany dla eksportu z dÅºwiÄ™kiem (fallback bez dÅºwiÄ™ku)
