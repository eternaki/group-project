# Story 7.5: Export Functionality

**Status:** To Do
**Assignee:** U1 (Danylo Lohachov)
**Priority:** Medium
**Sprint:** 7 - Demo Application

---

## Description

As a user, I want to export annotations as JSON.

---

## Acceptance Criteria

- [ ] Download button added
- [ ] COCO format JSON generated
- [ ] Filename includes timestamp
- [ ] Export works for single image

---

## Tasks

- [ ] Create export function
- [ ] Convert annotations to COCO format
- [ ] Generate downloadable JSON
- [ ] Add timestamp to filename

---

## Implementation

```python
import json
from datetime import datetime

def export_annotations(annotations: list, image_info: dict) -> str:
    """Convert annotations to COCO JSON string."""
    from packages.data.coco import COCODataset, COCOImage

    dataset = COCODataset()

    # Add image
    dataset.add_image(COCOImage(
        id=1,
        file_name=image_info.get("filename", "uploaded.jpg"),
        width=image_info["width"],
        height=image_info["height"]
    ))

    # Add annotations
    for ann in annotations:
        dataset.add_annotation(ann, image_id=1)

    # Convert to JSON
    return json.dumps(dataset.to_dict(), indent=2)

# In app.py
if annotations:
    json_str = export_annotations(annotations, {
        "filename": uploaded_file.name,
        "width": image_np.shape[1],
        "height": image_np.shape[0]
    })

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"annotations_{timestamp}.json"

    st.download_button(
        label="Download Annotations (JSON)",
        data=json_str,
        file_name=filename,
        mime="application/json"
    )
```

---

## Output

- `apps/demo/app.py` (updated)
