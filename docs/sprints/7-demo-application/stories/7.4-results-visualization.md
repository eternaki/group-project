# Story 7.4: Results Visualization

**Status:** To Do
**Assignee:** U1 (Danylo Lohachov)
**Priority:** High
**Sprint:** 7 - Demo Application

---

## Description

As a user, I want to see annotated results visually.

---

## Acceptance Criteria

- [ ] Bounding box drawn on image
- [ ] Keypoints drawn with skeleton
- [ ] Breed label displayed
- [ ] Emotion displayed with confidence bar

---

## Tasks

- [ ] Create visualization utility functions
- [ ] Draw bounding boxes with OpenCV/PIL
- [ ] Draw keypoints and skeleton
- [ ] Add text labels for breed and emotion
- [ ] Show confidence bars
- [ ] Display side-by-side (original vs annotated)

---

## Implementation

```python
# apps/demo/visualization.py

import cv2
import numpy as np
from PIL import Image, ImageDraw, ImageFont

def draw_annotations(image: np.ndarray, annotations: list) -> np.ndarray:
    """Draw all annotations on image."""
    result = image.copy()

    for ann in annotations:
        # Draw bounding box
        x, y, w, h = ann.bbox
        cv2.rectangle(result, (x, y), (x+w, y+h), (0, 255, 0), 2)

        # Draw keypoints
        for kp in ann.keypoints.points:
            if kp.visibility > 0:
                cv2.circle(result, (int(kp.x), int(kp.y)), 3, (255, 0, 0), -1)

        # Draw label
        label = f"{ann.breed_name} - {ann.emotion_name}"
        cv2.putText(result, label, (x, y-10),
                    cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)

    return result

# In app.py
if st.button("Analyze"):
    with st.spinner("Processing..."):
        annotations = pipeline.process_frame(image_np)

    annotated = draw_annotations(image_np, annotations)

    col1, col2 = st.columns(2)
    with col1:
        st.image(image_np, caption="Original")
    with col2:
        st.image(annotated, caption="Annotated")

    # Show details
    for i, ann in enumerate(annotations):
        st.subheader(f"Dog {i+1}")
        st.write(f"**Breed:** {ann.breed_name} ({ann.confidence_breed:.1%})")
        st.write(f"**Emotion:** {ann.emotion_name} ({ann.confidence_emotion:.1%})")
```

---

## Output

- `apps/demo/visualization.py`
- `apps/demo/app.py` (updated)
