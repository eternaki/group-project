# –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≠–º–æ—Ü–∏–π

**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5
**–î–∞—Ç–∞:** 25 —è–Ω–≤–∞—Ä—è 2026
**–ü—Ä–æ–µ–∫—Ç:** Dog FACS Dataset

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∏–π –û–±–∑–æ—Ä Pipeline](#–æ–±—â–∏–π-–æ–±–∑–æ—Ä-pipeline)
2. [–§–∞–∑–∞ 1: –î–µ—Ç–µ–∫—Ü–∏—è Keypoints](#—Ñ–∞–∑–∞-1-–¥–µ—Ç–µ–∫—Ü–∏—è-keypoints)
3. [–§–∞–∑–∞ 2: –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è Action Units (AU)](#—Ñ–∞–∑–∞-2-—ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è-action-units-au)
4. [–§–∞–∑–∞ 3: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≠–º–æ—Ü–∏–π](#—Ñ–∞–∑–∞-3-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è-—ç–º–æ—Ü–∏–π)
5. [–î–µ—Ç–∞–ª–∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–¥–µ—Ç–∞–ª–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
6. [–ù–∞—É—á–Ω–æ–µ –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ](#–Ω–∞—É—á–Ω–æ–µ-–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)

---

## –û–±—â–∏–π –û–±–∑–æ—Ä Pipeline

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —ç–º–æ—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –Ω–∞—É—á–Ω–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ **DogFACS** (Dog Facial Action Coding System):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PIPELINE –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–Ø –≠–ú–û–¶–ò–ô                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

    –í—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (BGR, np.ndarray)
              ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –§–ê–ó–ê 1: Keypoints Detection    ‚îÇ
    ‚îÇ  Model: SimpleBaseline (HRNet)  ‚îÇ
    ‚îÇ  Output: 20 –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üì
    Keypoints (x, y, visibility) √ó 20 = 60 –∑–Ω–∞—á–µ–Ω–∏–π
              ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –§–ê–ó–ê 2: Action Units (AU)      ‚îÇ
    ‚îÇ  Method: –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á—ë—Ç—ã ‚îÇ
    ‚îÇ  Output: 12 Action Units        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üì
    Features: Keypoints (60) + AU (12) = 72 –ø—Ä–∏–∑–Ω–∞–∫–∞
              ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –§–ê–ó–ê 3: Emotion Classification ‚îÇ
    ‚îÇ  Method: MLP –∏–ª–∏ Rule-based     ‚îÇ
    ‚îÇ  Output: 6 –∫–ª–∞—Å—Å–æ–≤ —ç–º–æ—Ü–∏–π       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üì
    Emotion Prediction (emotion, confidence, probabilities, AU values)
```

### –î–≤–∞ –ü–æ–¥—Ö–æ–¥–∞ –∫ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ –º–µ—Ç–æ–¥–∞** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏–π:

1. **ML-–ø–æ–¥—Ö–æ–¥ (MLP)**: –ù–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ 72 –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö (keypoints + AU) ‚Üí 5 –æ–±—É—á–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
2. **Rule-based –ø–æ–¥—Ö–æ–¥**: –ù–∞—É—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ DogFACS –Ω–∞ –æ—Å–Ω–æ–≤–µ AU ‚Üí 6 –∫–ª–∞—Å—Å–æ–≤ (–±–µ–∑ –æ–±—É—á–µ–Ω–∏—è)

---

## –§–∞–∑–∞ 1: –î–µ—Ç–µ–∫—Ü–∏—è Keypoints

### 1.1 –ú–æ–¥–µ–ª—å Keypoints

**–§–∞–π–ª:** `packages/models/keypoints.py`

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **Backbone:** ResNet34 (–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ DogFLW dataset)
- **–ú–µ—Ç–æ–¥:** SimpleBaseline (ResNet + Deconvolution Head)
- **–í—Ö–æ–¥:** RGB –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 256√ó256
- **–í—ã—Ö–æ–¥:** Heatmaps 64√ó64 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 46 keypoints (DogFLW)

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
```python
Image (H, W, 3)
  ‚Üí Resize(256, 256)
  ‚Üí Normalize(ImageNet stats)
  ‚Üí ResNet34 backbone
  ‚Üí Deconv layers (3√ó)
  ‚Üí Heatmaps (46, 64, 64)
  ‚Üí Decode to coordinates
  ‚Üí Map 46‚Üí20 keypoints (–ø—Ä–æ–µ–∫—Ç)
```

### 1.2 –ö–∞–∫–∏–µ Keypoints –ú—ã –ù–∞—Ö–æ–¥–∏–º?

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç **20 –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫ –Ω–∞ –º–æ—Ä–¥–µ —Å–æ–±–∞–∫–∏**:

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ê–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è AU |
|----|----------|------------------------|---------------------|
| 0 | `left_eye` | –¶–µ–Ω—Ç—Ä –ª–µ–≤–æ–≥–æ –≥–ª–∞–∑–∞ | AU_eye_opening, AU_brow_raise |
| 1 | `right_eye` | –¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≥–æ –≥–ª–∞–∑–∞ | AU_eye_opening, AU_brow_raise |
| 2 | `nose` | –ö–æ–Ω—á–∏–∫ –Ω–æ—Å–∞ | AU_nose_wrinkle, AU_jaw_drop |
| 3 | `left_ear_base` | –û—Å–Ω–æ–≤–∞–Ω–∏–µ –ª–µ–≤–æ–≥–æ —É—Ö–∞ | AU_ear_forward, AU_ear_back |
| 4 | `right_ear_base` | –û—Å–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–æ–≥–æ —É—Ö–∞ | AU_ear_forward, AU_ear_back |
| 5 | `left_ear_tip` | –ö–æ–Ω—á–∏–∫ –ª–µ–≤–æ–≥–æ —É—Ö–∞ | AU_ear_forward, AU_ear_asymmetry |
| 6 | `right_ear_tip` | –ö–æ–Ω—á–∏–∫ –ø—Ä–∞–≤–æ–≥–æ —É—Ö–∞ | AU_ear_forward, AU_ear_asymmetry |
| 7 | `left_mouth_corner` | –õ–µ–≤—ã–π —É–≥–æ–ª —Ä—Ç–∞ | AU_lip_corner_pull, AU_mouth_open |
| 8 | `right_mouth_corner` | –ü—Ä–∞–≤—ã–π —É–≥–æ–ª —Ä—Ç–∞ | AU_lip_corner_pull, AU_mouth_open |
| 9 | `upper_lip` | –¶–µ–Ω—Ç—Ä –≤–µ—Ä—Ö–Ω–µ–π –≥—É–±—ã | AU_mouth_open, AU_nose_wrinkle |
| 10 | `lower_lip` | –¶–µ–Ω—Ç—Ä –Ω–∏–∂–Ω–µ–π –≥—É–±—ã | AU_mouth_open, AU_jaw_drop |
| 11 | `chin` | –ü–æ–¥–±–æ—Ä–æ–¥–æ–∫ | AU_jaw_drop, AU_face_elongation |
| 12 | `left_cheek` | –õ–µ–≤–∞—è —â–µ–∫–∞ | AU_muzzle_width |
| 13 | `right_cheek` | –ü—Ä–∞–≤–∞—è —â–µ–∫–∞ | AU_muzzle_width |
| 14 | `forehead` | –¶–µ–Ω—Ç—Ä –ª–±–∞ | AU_brow_raise, AU_face_elongation |
| 15 | `left_eyebrow` | –õ–µ–≤–∞—è –±—Ä–æ–≤—å (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è) | AU_brow_raise |
| 16 | `right_eyebrow` | –ü—Ä–∞–≤–∞—è –±—Ä–æ–≤—å (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è) | AU_brow_raise |
| 17 | `muzzle_top` | –í–µ—Ä—Ö –º–æ—Ä–¥—ã | AU_nose_wrinkle |
| 18 | `muzzle_left` | –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–æ—Ä–¥—ã | AU_muzzle_width |
| 19 | `muzzle_right` | –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–æ—Ä–¥—ã | AU_muzzle_width |

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
```python
# –ö–∞–∂–¥—ã–π keypoint = (x, y, visibility)
keypoints_flat = [x0, y0, v0, x1, y1, v1, ..., x19, y19, v19]  # 60 –∑–Ω–∞—á–µ–Ω–∏–π
```

### 1.3 Mapping –∏–∑ DogFLW

–ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ **DogFLW dataset —Å 46 keypoints**, –Ω–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ **20 –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö**:

```python
# –ü—Ä–∏–º–µ—Ä mapping (–∏–∑ schemas.py)
PROJECT_TO_DOGFLW_MAPPING = {
    0: 0,   # left_eye ‚Üí DogFLW landmark 0
    1: 1,   # right_eye ‚Üí DogFLW landmark 1
    2: 14,  # nose ‚Üí DogFLW landmark 14
    3: 32,  # left_ear_base ‚Üí DogFLW landmark 32
    # ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
}
```

### 1.4 Test-Time Augmentation (TTA)

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**:

1. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí keypoints_original
2. –û—Ç—Ä–∞–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí keypoints_flipped
3. –û—Ç—Ä–∞–∑–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø–æ–º–µ–Ω—è—Ç—å –ª–µ–≤—ã–µ/–ø—Ä–∞–≤—ã–µ —Ç–æ—á–∫–∏
4. –£—Å—Ä–µ–¥–Ω–∏—Ç—å —Å –≤–µ—Å–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ confidence

```python
# –ü—Ä–∏–º–µ—Ä TTA
avg_x = (orig_x * orig_conf + flip_x * flip_conf) / (orig_conf + flip_conf)
```

---

## –§–∞–∑–∞ 2: –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è Action Units (AU)

### 2.1 –ß—Ç–æ –¢–∞–∫–æ–µ Action Units?

**Action Units (AU)** ‚Äî —ç—Ç–æ **–æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ª–∏—Ü–µ–≤—ã—Ö –º—ã—à—Ü**, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ **DogFACS** (Dog Facial Action Coding System).

**–ö–ª—é—á–µ–≤–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ:**
- **AU** = –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–±—Ä–æ–≤—å –ø–æ–¥–Ω—è—Ç–∞ –Ω–∞ X –º–º")
- **–≠–º–æ—Ü–∏—è** = —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ AU

### 2.2 –ö–∞–∫–∏–µ Action Units –ú—ã –í—ã—á–∏—Å–ª—è–µ–º?

**–§–∞–π–ª:** `packages/models/action_units.py`

–°–∏—Å—Ç–µ–º–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç **12 Action Units** –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ keypoints:

| ID | AU Name | DogFACS Code | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º—É–ª–∞ |
|----|---------|--------------|----------|---------|
| 0 | `AU_brow_raise` | AU101/102 | –ü–æ–¥–Ω—è—Ç–∏–µ –±—Ä–æ–≤–∏ | `dist(brow, eye) / eye_distance` |
| 1 | `AU_ear_forward` | EAD102/AU201 | –£—à–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–ø–µ—Ä—ë–¥ | `1 - abs(ear_angle) / œÄ` |
| 2 | `AU_ear_back` | EAD103/AU202 | –£—à–∏ –ø—Ä–∏–∂–∞—Ç—ã –Ω–∞–∑–∞–¥ | `1 - AU_ear_forward` |
| 3 | `AU_ear_asymmetry` | EAD104 | –ê—Å–∏–º–º–µ—Ç—Ä–∏—è —É—à–µ–π | `abs(left_angle - right_angle) / œÄ` |
| 4 | `AU_eye_opening` | Inverse AU143/145 | –û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–∑ | `mean(visibility(left_eye, right_eye))` |
| 5 | `AU_mouth_open` | AU25/26 | –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞—Å—Ç–∏ | `dist(upper_lip, lower_lip) / eye_distance` |
| 6 | `AU_lip_corner_pull` | AU27 | –û—Ç—Ç—è–≥–∏–≤–∞–Ω–∏–µ —É–≥–æ–ª–∫–æ–≤ —Ä—Ç–∞ | `angle(upper_lip ‚Üí corners)` |
| 7 | `AU_jaw_drop` | AU26 | –û–ø—É—â–µ–Ω–∏–µ —á–µ–ª—é—Å—Ç–∏ | `dist(nose, chin) / eye_distance` |
| 8 | `AU_nose_wrinkle` | AU301 | –°–º–æ—Ä—â–∏–≤–∞–Ω–∏–µ –Ω–æ—Å–∞ | `1 - dist(nose, upper_lip) / eye_distance` |
| 9 | `AU_muzzle_width` | - | –®–∏—Ä–∏–Ω–∞ –º–æ—Ä–¥—ã | `dist(muzzle_left, muzzle_right) / eye_distance` |
| 10 | `AU_face_elongation` | - | –í—ã—Ç—è–Ω—É—Ç–æ—Å—Ç—å –º–æ—Ä–¥—ã | `dist(forehead, chin) / eye_distance` |
| 11 | `AU_eye_distance` | - | –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≥–ª–∞–∑–∞–º–∏ | `dist(left_eye, right_eye) / 100` |

**–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É [0, 1]**

### 2.3 –î–µ—Ç–∞–ª–∏ –í—ã—á–∏—Å–ª–µ–Ω–∏–π AU

#### Referent Distance (–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)

–í—Å–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è **–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –≥–ª–∞–∑–∞–º–∏**:

```python
eye_distance = distance(left_eye, right_eye)
normalized_value = measurement / eye_distance
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–º–µ—Ä—É –≥–æ–ª–æ–≤—ã**.

#### –ü—Ä–∏–º–µ—Ä: AU_brow_raise (–ü–æ–¥–Ω—è—Ç–∏–µ –ë—Ä–æ–≤–∏)

```python
def _compute_brow_raise(coords, ref_dist):
    # Keypoints: 0=left_eye, 1=right_eye, 15=left_brow, 16=right_brow
    left_brow_eye_dist = distance(coords[15], coords[0])   # KP_LEFT_BROW ‚Üí KP_LEFT_EYE
    right_brow_eye_dist = distance(coords[16], coords[1])  # KP_RIGHT_BROW ‚Üí KP_RIGHT_EYE

    avg_dist = (left_brow_eye_dist + right_brow_eye_dist) / 2
    normalized = avg_dist / ref_dist

    # –¢–∏–ø–∏—á–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: 0.2-0.5, –∫–ª–∏–ø–Ω—É—Ç—å –∫ [0, 1]
    return clip((normalized - 0.2) / 0.3, 0.0, 1.0)
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ keypoints:** 0 (left_eye), 1 (right_eye), 15 (left_brow), 16 (right_brow)

#### –ü—Ä–∏–º–µ—Ä: AU_ear_forward (–£—à–∏ –í–ø–µ—Ä—ë–¥)

```python
def _compute_ear_forward(coords):
    # Keypoints: 3=left_ear_base, 4=right_ear_base, 5=left_ear_tip, 6=right_ear_tip
    left_angle = angle(coords[3], coords[5])   # base ‚Üí tip
    right_angle = angle(coords[4], coords[6])

    avg_angle = (abs(left_angle) + abs(right_angle)) / 2

    # –ú–∞–ª—ã–π —É–≥–æ–ª = —É—à–∏ –≤–ø–µ—Ä—ë–¥
    return clip(1.0 - avg_angle / œÄ, 0.0, 1.0)
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ keypoints:** 3, 4 (ear_base), 5, 6 (ear_tip)

#### –ü—Ä–∏–º–µ—Ä: AU_mouth_open (–û—Ç–∫—Ä—ã—Ç–∏–µ –ü–∞—Å—Ç–∏)

```python
def _compute_mouth_open(coords, ref_dist):
    # Keypoints: 9=upper_lip, 10=lower_lip
    lip_dist = distance(coords[9], coords[10])
    normalized = lip_dist / ref_dist

    # –¢–∏–ø–∏—á–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: 0.0-0.3
    return clip(normalized / 0.3, 0.0, 1.0)
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ keypoints:** 9 (upper_lip), 10 (lower_lip)

### 2.4 Poselet ‚Äî –ß—Ç–æ –≠—Ç–æ?

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è poselet?

**–û—Ç–≤–µ—Ç:** –í –¥–∞–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **poselet –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é**.

**–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏:**
- **Poselet** –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º —Å–º—ã—Å–ª–µ ‚Äî —ç—Ç–æ –Ω–µ–±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞ (—á–∞—Å—Ç—å –ø–æ–∑—ã), –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–º
- –í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä 20 keypoints**, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–∑—É—é—Ç "–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ—Ä–¥—ã"
- –ö–∞–∂–¥—ã–π **Action Unit** –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ "–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä" —á–∞—Å—Ç–∏ –º–æ—Ä–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—à–µ–π", "–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä—Ç–∞")

**–ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ–±—Ä–∞–∑–Ω–æ:**
- –ù–∞–±–æ—Ä keypoints –æ–±—Ä–∞–∑—É–µ—Ç "poselet –º–æ—Ä–¥—ã —Å–æ–±–∞–∫–∏"
- –ö–∞–∂–¥—ã–π AU –æ–ø–∏—Å—ã–≤–∞–µ—Ç "–ª–æ–∫–∞–ª—å–Ω—ã–π poselet" (—É—à–∏, —Ä–æ—Ç, –±—Ä–æ–≤–∏ –∏ —Ç.–¥.)

---

## –§–∞–∑–∞ 3: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≠–º–æ—Ü–∏–π

### 3.1 –î–≤–∞ –ü–æ–¥—Ö–æ–¥–∞

#### –ü–æ–¥—Ö–æ–¥ 1: ML-Based (MLP Neural Network)

**–§–∞–π–ª:** `packages/models/emotion.py` (–∫–ª–∞—Å—Å `EmotionModel`)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Input: 72 features (60 keypoints + 12 AU)
   ‚Üì
FC(256) ‚Üí BatchNorm ‚Üí ReLU ‚Üí Dropout(0.3)
   ‚Üì
FC(128) ‚Üí BatchNorm ‚Üí ReLU ‚Üí Dropout(0.3)
   ‚Üì
FC(64) ‚Üí BatchNorm ‚Üí ReLU ‚Üí Dropout(0.3)
   ‚Üì
FC(5) ‚Üí Softmax
   ‚Üì
Output: [happy, sad, angry, fearful, relaxed] probabilities
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—É—á–∞–µ—Ç—Å—è –Ω–∞ **5 –∫–ª–∞—Å—Å–∞—Ö** (neutral –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ threshold)
- –ï—Å–ª–∏ `max(probabilities) < 0.35` ‚Üí —ç–º–æ—Ü–∏—è = **neutral**
- –¢—Ä–µ–±—É–µ—Ç **–æ–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞** (`emotion_keypoints.pt`)

**–ü—Ä–æ—Ü–µ—Å—Å Inference:**
```python
# 1. –ü–æ–ª—É—á–∏—Ç—å keypoints (60 –∑–Ω–∞—á–µ–Ω–∏–π)
keypoints_flat = [x0, y0, v0, ..., x19, y19, v19]

# 2. –ò–∑–≤–ª–µ—á—å AU (12 –∑–Ω–∞—á–µ–Ω–∏–π)
au_features = extract_action_units(keypoints_flat)

# 3. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ feature vector (72)
features = concat([keypoints_flat, au_features])

# 4. –ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ—Ä–µ–∑ MLP
logits = MLP(features)
probs = softmax(logits)  # 5 –∫–ª–∞—Å—Å–æ–≤

# 5. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —ç–º–æ—Ü–∏—é
if max(probs) < 0.35:
    emotion = "neutral"
else:
    emotion = argmax(probs)  # happy/sad/angry/fearful/relaxed
```

#### –ü–æ–¥—Ö–æ–¥ 2: Rule-Based (DogFACS Scientific Rules)

**–§–∞–π–ª:** `packages/models/emotion.py` (—Ñ—É–Ω–∫—Ü–∏—è `classify_emotion_from_au`)

**–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –Ω–∞—É—á–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö DogFACS** (Mota-Rojas et al. 2021)

**–ù–ï —Ç—Ä–µ–±—É–µ—Ç –æ–±—É—á–µ–Ω–∏—è** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞!

### 3.2 –î–µ—Ç–∞–ª–∏ Rule-Based –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ö–∞–∂–¥–∞—è —ç–º–æ—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç **score –æ—Ç 0 –¥–æ 1** –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∑–≤–µ—à–µ–Ω–Ω–æ–π —Å—É–º–º—ã AU:

#### HAPPY (–°—á–∞—Å—Ç–ª–∏–≤–∞—è)
```python
happy_score = (
    mouth_open * 0.35 +           # AU25 - –û—Ç–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç
    ear_forward * 0.25 +          # EAD102 - –£—à–∏ –≤–ø–µ—Ä—ë–¥
    brow_raise * 0.15 +           # AU101 - –ë—Ä–æ–≤–∏ –ø–æ–¥–Ω—è—Ç—ã
    (1 - ear_back) * 0.15 +       # –£—à–∏ –ù–ï –ø—Ä–∏–∂–∞—Ç—ã
    (1 - nose_lick) * 0.10        # –ù–µ—Ç —Å—Ç—Ä–µ—Å—Å–∞ (–æ–±–ª–∏–∑—ã–≤–∞–Ω–∏—è)
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å "—É–ª—ã–±–∫–∞")
- ‚úÖ –£—à–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–ø–µ—Ä—ë–¥ (–∏–Ω—Ç–µ—Ä–µ—Å)
- ‚úÖ –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è –ø–æ–∑–∞

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** AU_mouth_open, AU_ear_forward, AU_brow_raise, AU_ear_back, nose_lick (proxy)

#### SAD (–ì—Ä—É—Å—Ç–Ω–∞—è)
```python
sad_score = (
    ear_back * 0.40 +             # EAD103 - –£—à–∏ –ø—Ä–∏–∂–∞—Ç—ã –Ω–∞–∑–∞–¥
    blink * 0.15 +                # AU145 - –ü—Ä–∏–∫—Ä—ã—Ç—ã–µ –≥–ª–∞–∑–∞
    (1 - brow_raise) * 0.15 +     # –ë—Ä–æ–≤–∏ –ù–ï –ø–æ–¥–Ω—è—Ç—ã
    (1 - mouth_open) * 0.15 +     # –†–æ—Ç –∑–∞–∫—Ä—ã—Ç
    nose_lick * 0.15              # –û–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ (—Å—Ç—Ä–µ—Å—Å)
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ –£—à–∏ –ø—Ä–∏–∂–∞—Ç—ã (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–∑–Ω–∞–∫)
- ‚úÖ –ü—Ä–∏–∫—Ä—ã—Ç—ã–µ –≥–ª–∞–∑–∞
- ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∏–º–∏–∫–∞

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** AU_ear_back, AU_eye_opening (inverted), AU_brow_raise, AU_mouth_open, nose_lick

#### ANGRY (–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è)
```python
angry_score = (
    ((mouth_open + jaw_drop) / 2) * 0.30 +  # –û—Ç–∫—Ä—ã—Ç–∞—è –ø–∞—Å—Ç—å + —á–µ–ª—é—Å—Ç—å
    lip_corner_pull * 0.25 +       # AU401 - –û—Å–∫–∞–ª (–æ–±–Ω–∞–∂—ë–Ω–Ω—ã–µ –∑—É–±—ã)
    nose_wrinkle * 0.15 +          # AU301 - –°–º–æ—Ä—â–µ–Ω–Ω—ã–π –Ω–æ—Å
    ((ear_back + ear_asymmetry) / 2) * 0.15 +  # –£—à–∏ –≤ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    blink * 0.15                   # –ü—Ä–∏—â—É—Ä–µ–Ω–Ω—ã–µ –≥–ª–∞–∑–∞
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ –û—Ç–∫—Ä—ã—Ç–∞—è –ø–∞—Å—Ç—å —Å –æ—Å–∫–∞–ª–æ–º
- ‚úÖ –û–±–Ω–∞–∂—ë–Ω–Ω—ã–µ –∑—É–±—ã (lip_corner_pull)
- ‚úÖ –°–º–æ—Ä—â–µ–Ω–Ω—ã–π –Ω–æ—Å
- ‚úÖ –ê—Å–∏–º–º–µ—Ç—Ä–∏—è —É—à–µ–π (—É–≥—Ä–æ–∑–∞)

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** AU_mouth_open, AU_jaw_drop, AU_lip_corner_pull, AU_nose_wrinkle, AU_ear_back, AU_ear_asymmetry, AU_eye_opening

#### FEARFUL (–ò—Å–ø—É–≥–∞–Ω–Ω–∞—è)
```python
fearful_score = (
    ear_back * 0.30 +              # EAD103 - –£—à–∏ –ø—Ä–∏–∂–∞—Ç—ã
    nose_lick * 0.25 +             # AD137 - –û–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ (–ì–õ–ê–í–ù–´–ô –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–µ—Å—Å–∞!)
    blink * 0.20 +                 # AU145 - –ß–∞—Å—Ç–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ
    brow_raise * 0.12 +            # AU101 - –ë—Ä–æ–≤–∏ –ø–æ–¥–Ω—è—Ç—ã (—É–¥–∏–≤–ª–µ–Ω–∏–µ)
    (1 - mouth_open) * 0.13        # –†–æ—Ç –∑–∞–∫—Ä—ã—Ç
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ **–û–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ –Ω–æ—Å–∞** ‚Äî –ì–õ–ê–í–ù–´–ô –ø—Ä–∏–∑–Ω–∞–∫ —Å—Ç—Ä–µ—Å—Å–∞ –≤ DogFACS!
- ‚úÖ –£—à–∏ –ø—Ä–∏–∂–∞—Ç—ã
- ‚úÖ –ß–∞—Å—Ç–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ
- ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** AU_ear_back, nose_lick (proxy), AU_eye_opening, AU_brow_raise, AU_mouth_open

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `nose_lick` (AD137) –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ **proxy** –∏–∑ mouth_open –∏ jaw_drop, —Ç–∞–∫ –∫–∞–∫ –ø—Ä—è–º–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –æ–±–ª–∏–∑—ã–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω–∞:
```python
nose_lick = max(0.0, mouth_open * 0.5 - jaw_drop * 0.3)
```

#### RELAXED (–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è)
```python
relaxed_score = (
    (1 - mean_activation) * 0.50 +  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤—Å–µ—Ö AU
    (1 - ear_back) * 0.15 +         # –£—à–∏ –ù–ï –ø—Ä–∏–∂–∞—Ç—ã
    (1 - ear_forward) * 0.15 +      # –£—à–∏ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    (1 - nose_lick) * 0.10 +        # –ù–µ—Ç —Å—Ç—Ä–µ—Å—Å–∞
    (1 - nose_wrinkle) * 0.10       # –ù–æ—Å –ù–ï —Å–º–æ—Ä—â–µ–Ω
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è** –≤—Å–µ—Ö AU (—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ –º—ã—à—Ü—ã)
- ‚úÖ –£—à–∏ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** –í—Å–µ AU (—á–µ—Ä–µ–∑ mean_activation), AU_ear_back, AU_ear_forward, nose_lick, AU_nose_wrinkle

#### NEUTRAL (–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è)
```python
neutral_score = (
    (1 - mean_activation) * 0.70 +
    (1 - (mouth_open + jaw_drop) / 2) * 0.15 +
    (1 - (ear_back + ear_forward) / 2) * 0.15
)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ **–û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è** –≤—Å–µ—Ö AU
- ‚úÖ –ë–∞–∑–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–æ—è
- ‚úÖ –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç relaxed –º–µ–Ω—å—à–µ–π –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ AU:** –í—Å–µ AU (—á–µ—Ä–µ–∑ mean_activation), AU_mouth_open, AU_jaw_drop, AU_ear_back, AU_ear_forward

### 3.3 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –í—ã–±–æ—Ä –≠–º–æ—Ü–∏–∏

–ü–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—Å–µ—Ö scores –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **softmax-–ø–æ–¥–æ–±–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**:

```python
# 1. –í—ã—á–∏—Å–ª–∏—Ç—å scores –¥–ª—è –≤—Å–µ—Ö 6 —ç–º–æ—Ü–∏–π
scores = {
    'happy': happy_score,
    'sad': sad_score,
    'angry': angry_score,
    'fearful': fearful_score,
    'relaxed': relaxed_score,
    'neutral': neutral_score,
}

# 2. Softmax-like –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å temperature=2.0
temperature = 2.0
exp_scores = {k: exp(v * temperature) for k, v in scores.items()}
total_exp = sum(exp_scores.values())
probabilities = {k: v / total_exp for k, v in exp_scores.items()}

# 3. –ù–∞–π—Ç–∏ –ª—É—á—à—É—é —ç–º–æ—Ü–∏—é
best_emotion = argmax(probabilities)
best_prob = probabilities[best_emotion]

# 4. Threshold –¥–ª—è neutral
if best_prob < 0.35 and best_emotion != 'neutral':
    best_emotion = 'neutral'
    best_prob = probabilities['neutral']
```

**Temperature = 2.0** –¥–µ–ª–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –±–æ–ª–µ–µ "—É–≤–µ—Ä–µ–Ω–Ω—ã–º–∏" (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É scores).

---

## –î–µ—Ç–∞–ª–∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 4.1 –ü–æ–ª–Ω—ã–π Pipeline Inference

**–§–∞–π–ª:** `packages/models/emotion.py`

```python
# –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å keypoints –æ—Ç –º–æ–¥–µ–ª–∏ keypoints
keypoints_prediction = keypoints_model.predict(dog_crop_image)
keypoints_flat = keypoints_prediction.to_coco_format()  # [x0, y0, v0, ...]

# –®–∞–≥ 2A: ML-–ø–æ–¥—Ö–æ–¥
emotion_model = EmotionModel(config)
emotion_prediction = emotion_model.predict(keypoints_flat)

# –®–∞–≥ 2B: Rule-based –ø–æ–¥—Ö–æ–¥ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
emotion_prediction = classify_emotion_from_keypoints(keypoints_flat)

# –†–µ–∑—É–ª—å—Ç–∞—Ç
print(f"Emotion: {emotion_prediction.emotion}")
print(f"Confidence: {emotion_prediction.confidence:.2%}")
print(f"Probabilities: {emotion_prediction.probabilities}")
print(f"Action Units: {emotion_prediction.action_units}")
```

### 4.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∞–Ω–Ω—ã—Ö

#### EmotionPrediction
```python
@dataclass
class EmotionPrediction:
    emotion_id: int              # 0-5 (–∏–Ω–¥–µ–∫—Å –∫–ª–∞—Å—Å–∞)
    emotion: str                 # "happy", "sad", "angry", "fearful", "relaxed", "neutral"
    confidence: float            # 0.0-1.0 (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å best –∫–ª–∞—Å—Å–∞)
    probabilities: dict[str, float]  # –í—Å–µ 6 –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
    action_units: dict[str, float]   # –ó–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö 12 AU
```

#### ActionUnitsPrediction
```python
@dataclass
class ActionUnitsPrediction:
    values: dict[str, float]     # AU_name ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ (0.0-1.0)
    features: np.ndarray         # –í–µ–∫—Ç–æ—Ä –¥–ª—è –º–æ–¥–µ–ª–∏ (12 –∑–Ω–∞—á–µ–Ω–∏–π)
```

### 4.3 –ö–ª–∞—Å—Å—ã –≠–º–æ—Ü–∏–π

**ML-based (5 –æ–±—É—á–µ–Ω–Ω—ã—Ö):**
```python
EMOTION_CLASSES_TRAINED = ['happy', 'sad', 'angry', 'fearful', 'relaxed']
```

**Rule-based (6 –∫–ª–∞—Å—Å–æ–≤):**
```python
EMOTION_CLASSES = ['happy', 'sad', 'angry', 'fearful', 'relaxed', 'neutral']
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Neutral –≤ ML-–ø–æ–¥—Ö–æ–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ threshold (< 0.35), –Ω–µ –æ–±—É—á–∞–µ—Ç—Å—è.

### 4.4 –†–∞–∑–º–µ—Ä—ã Feature Vectors

```python
NUM_KEYPOINTS = 20
KEYPOINTS_FEATURES = 20 * 3 = 60   # (x, y, visibility)
NUM_ACTION_UNITS = 12
AU_FEATURES = 12

# –î–ª—è ML-–º–æ–¥–µ–ª–∏
INPUT_FEATURES = 60 + 12 = 72      # Keypoints + AU

# Legacy (—Ç–æ–ª—å–∫–æ keypoints)
INPUT_FEATURES_LEGACY = 60         # –¢–æ–ª—å–∫–æ keypoints
```

---

## –ù–∞—É—á–Ω–æ–µ –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

### 5.1 DogFACS (Dog Facial Action Coding System)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** Mota-Rojas et al. 2021, [animalfacs.com/dogfacs](https://www.animalfacs.com/dogfacs)

**–ß—Ç–æ —Ç–∞–∫–æ–µ DogFACS:**
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è **FACS** (Facial Action Coding System) –¥–ª—è —Å–æ–±–∞–∫
- –ù–∞—É—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–º–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞—Ç–æ–º–∏–∏ –º—ã—à—Ü
- –ü–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ –∏–∑–º–µ—Ä—è—Ç—å** –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ª–∏—Ü–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —ç—Ç–æ–ª–æ–≥–∏–∏ –∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **Action Units (AU)** ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º—ã—à—Ü –∏–ª–∏ –≥—Ä—É–ø–ø –º—ã—à—Ü
- **Ear Action Descriptors (EAD)** ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –¥–ª—è —Å–æ–±–∞–∫ –¥–≤–∏–∂–µ–Ω–∏—è —É—à–µ–π
- **Action Descriptors (AD)** ‚Äî —Å–ª–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ)

### 5.2 –°–≤—è–∑—å AU ‚Üí –≠–º–æ—Ü–∏–∏

**–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ DogFACS:**
- –≠–º–æ—Ü–∏–∏ –ù–ï –∏–∑–º–µ—Ä—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- –≠–º–æ—Ü–∏–∏ **–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è** –∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ AU
- –û–¥–Ω–∞ —ç–º–æ—Ü–∏—è = **–∫–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö AU**

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:**
- **Fear (—Å—Ç—Ä–∞—Ö):** EAD103 (–ø—Ä–∏–∂–∞—Ç—ã–µ —É—à–∏) + AD137 (–æ–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ) + AU145 (–º–æ—Ä–≥–∞–Ω–∏–µ)
- **Anger (–∞–≥—Ä–µ—Å—Å–∏—è):** AU301 (—Å–º–æ—Ä—â–µ–Ω–Ω—ã–π –Ω–æ—Å) + AU401 (–æ—Å–∫–∞–ª) + –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–∞—Å—Ç—å
- **Happy (—Ä–∞–¥–æ—Å—Ç—å):** –û—Ç–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç + —É—à–∏ –≤–ø–µ—Ä—ë–¥ + —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ –±—Ä–æ–≤–∏

### 5.3 –ü–æ—á–µ–º—É Keypoints ‚Üí AU ‚Üí Emotions?

**–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–º–µ–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:**
   - –ú–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å "–ø–æ—á–µ–º—É —Å–æ–±–∞–∫–∞ –≥—Ä—É—Å—Ç–Ω–∞—è" (—É—à–∏ –ø—Ä–∏–∂–∞—Ç—ã, –≥–ª–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç—ã)
   - –ù–µ —á—ë—Ä–Ω—ã–π —è—â–∏–∫

2. **–ù–∞—É—á–Ω–∞—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:**
   - –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∞–Ω–∞—Ç–æ–º–∏–∏ –∏ —ç—Ç–æ–ª–æ–≥–∏–∏
   - –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

3. **–ì–∏–±–∫–æ—Å—Ç—å:**
   - –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —ç–º–æ—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

4. **–û–±—É—á–µ–Ω–∏–µ —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö:**
   - Rule-based –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç–∞ —ç–º–æ—Ü–∏–π
   - –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ keypoints

### 5.4 –ü–æ—á–µ–º—É 20 Keypoints?

**–í—ã–±–æ—Ä 20 keypoints –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞:**
- **–ü–æ–ª–Ω–æ—Ç–∞:** –ü–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –≤–∞–∂–Ω—ã–µ –∑–æ–Ω—ã –º–æ—Ä–¥—ã (–≥–ª–∞–∑–∞, —É—à–∏, –Ω–æ—Å, —Ä–æ—Ç, –±—Ä–æ–≤–∏)
- **–ë–∞–ª–∞–Ω—Å:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è AU, –Ω–æ –Ω–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:** –ú–æ–¥–µ–ª—å DogFLW –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 46, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ
- **–ê–Ω–∞—Ç–æ–º–∏—è:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç DogFACS Action Units

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ keypoints –¥–ª—è —ç–º–æ—Ü–∏–π:**
- **–£—à–∏ (3, 4, 5, 6):** –ì–ª–∞–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–±–∞–∫–∏
- **–ì–ª–∞–∑–∞ (0, 1, 15, 16):** –û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞
- **–†–æ—Ç (7, 8, 9, 10, 11):** –û—Å–∫–∞–ª, –∑–µ–≤–∞–Ω–∏–µ, –æ–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ
- **–ù–æ—Å (2, 17):** –°–º–æ—Ä—â–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–∏

---

## –†–µ–∑—é–º–µ

### –ü–æ–ª–Ω–∞—è –¶–µ–ø–æ—á–∫–∞: Image ‚Üí Emotion

```
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±–∞–∫–∏ (256√ó256√ó3)
    ‚Üì
[SimpleBaseline Model - ResNet34 + Deconv]
    ‚Üí Heatmaps (46 keypoints DogFLW)
    ‚Üí Decode to coordinates
    ‚Üí Map 46 ‚Üí 20 keypoints –ø—Ä–æ–µ–∫—Ç–∞
    ‚Üì
20 Keypoints [(x, y, visibility) √ó 20 = 60 –∑–Ω–∞—á–µ–Ω–∏–π]
    –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ: left_eye, right_eye, nose, ears (base+tip),
                  mouth corners, lips, chin, cheeks, forehead,
                  eyebrows, muzzle (top+sides)
    ‚Üì
[ActionUnitsExtractor - –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è]
    ‚Üí Referent distance = dist(left_eye, right_eye)
    ‚Üí 12 AU –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ dist(), angle(), visibility
    ‚Üì
12 Action Units [–∑–Ω–∞—á–µ–Ω–∏—è 0.0-1.0]
    AU_brow_raise, AU_ear_forward, AU_ear_back, AU_ear_asymmetry,
    AU_eye_opening, AU_mouth_open, AU_lip_corner_pull, AU_jaw_drop,
    AU_nose_wrinkle, AU_muzzle_width, AU_face_elongation, AU_eye_distance
    ‚Üì
[Emotion Classification]
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë –í–∞—Ä–∏–∞–Ω—Ç A: ML-Based (MLP)                                 ‚ïë
    ‚ïë   Features (60 keypoints + 12 AU = 72)                    ‚ïë
    ‚ïë   ‚Üí MLP [256 ‚Üí 128 ‚Üí 64 ‚Üí 5]                             ‚ïë
    ‚ïë   ‚Üí Softmax ‚Üí [happy, sad, angry, fearful, relaxed]      ‚ïë
    ‚ïë   ‚Üí If max_prob < 0.35: neutral                          ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë –í–∞—Ä–∏–∞–Ω—Ç B: Rule-Based (DogFACS)                          ‚ïë
    ‚ïë   AU values ‚Üí Weighted scoring —Ñ–æ—Ä–º—É–ª—ã                    ‚ïë
    ‚ïë   ‚Üí 6 scores [happy, sad, angry, fearful, relaxed, neutral]‚ïë
    ‚ïë   ‚Üí Softmax-like normalization (temp=2.0)                ‚ïë
    ‚ïë   ‚Üí argmax(probabilities)                                ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    ‚Üì
EmotionPrediction
    emotion: "happy" | "sad" | "angry" | "fearful" | "relaxed" | "neutral"
    emotion_id: 0-5
    confidence: 0.85
    probabilities: {happy: 0.85, sad: 0.05, angry: 0.03, ...}
    action_units: {AU_brow_raise: 0.32, AU_ear_forward: 0.78, ...}
```

### –ö–ª—é—á–µ–≤—ã–µ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–ò–µ—Ä–∞—Ä—Ö–∏—á–Ω–æ—Å—Ç—å:** Image ‚Üí Keypoints ‚Üí AU ‚Üí Emotions
‚úÖ **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥
‚úÖ **–ù–∞—É—á–Ω–∞—è –±–∞–∑–∞:** DogFACS ‚Äî –ø—Ä–∏–∑–Ω–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ —ç—Ç–æ–ª–æ–≥–∏–∏
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** Rule-based –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–±—É—á–µ–Ω–∏—è, ML-based –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
‚úÖ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–º–µ—Ä—É –≥–æ–ª–æ–≤—ã —á–µ—Ä–µ–∑ referent distance
‚úÖ **Robustness:** TTA (Test-Time Augmentation) –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ keypoints

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç keypoints:** –ü–ª–æ—Ö–∏–µ keypoints ‚Üí –ø–ª–æ—Ö–∏–µ AU ‚Üí –ø–ª–æ—Ö–∏–µ —ç–º–æ—Ü–∏–∏
‚ö†Ô∏è **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ AU (–º–æ—Ä–≥–∞–Ω–∏–µ, –æ–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ) –ª—É—á—à–µ –¥–µ—Ç–µ–∫—Ç–∏—Ç—å –Ω–∞ –≤–∏–¥–µ–æ
‚ö†Ô∏è **Proxy –¥–ª—è AD137:** –û–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ, –Ω–µ –Ω–∞–ø—Ä—è–º—É—é
‚ö†Ô∏è **Frontal pose:** –õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö

---

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —ç–º–æ—Ü–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ Dog FACS Dataset.**

**–ê–≤—Ç–æ—Ä—ã –º–æ–¥—É–ª–µ–π:**
- `packages/models/keypoints.py` - SimpleBaseline –¥–ª—è keypoints
- `packages/models/action_units.py` - –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è AU
- `packages/models/emotion.py` - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–º–æ—Ü–∏–π (ML + Rule-based)
- `packages/data/schemas.py` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è 20 keypoints

**–°—Å—ã–ª–∫–∏:**
- [DogFACS Official](https://www.animalfacs.com/dogfacs)
- Mota-Rojas et al. 2021 - Scientific basis
- SimpleBaseline (Xiao et al. 2018) - Keypoints architecture
